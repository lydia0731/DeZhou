# DeZhou

手遊【食物語】攻略機器人-德州扒雞
二創非官方，玩家以便利為目的開發的非營利Line聊天機器人

--------
研發動機
---
起初是和朋友去玩《食物語》這款遊戲，由於遊戲內角色、裝備、道具、技能等多樣性，玩家無法做到全部記住，雖有各式各樣統整好的攻略，但使用手機遠沒有用電腦查詢來的便利。

在一名協會成員提出這項缺點，同時期望如果能用 LINE 查詢遊戲攻略就好了，引發了我製作機器人的想法。

因個人愛好，將機器人帳號設定成喜愛的遊戲內角色，不料引起遊戲群組內不少玩家共鳴，也造就了之後的聊天功能。

--------
功能介紹
---
功能主要分為兩個部分：聊天、查詢。

1.聊天
 - 可與機器人對話或新增聊天詞彙。

2.查詢
 - 可輸入指令向機器人詢問遊戲中食魂、膳具和技能等資訊。

--------
使用的技術／環境
---
原目的是想製作給工會成員長期使用，因此開發工具都盡量以免付費為主，考慮到一同維護資料的管理員們不會使用 SQL，所以改用大家較常用得 Google 試算表做為資料庫，為此也需要用到 Google Sheet API ，使 Line bot 能抓取/存放試算表資料。

本打算使用虛擬主機存放程式檔，但免費版都有使用上限制，在無法確定資料庫大小和流量會達到多少的情況下，同時又希望能維持機器人24小時運作，因此捨棄了放在自己電腦或虛擬主機的想法，將腦筋動到了 Google 雲端硬碟上。

GoogleAppScript 提供使用者簡易開發環境，並且也能協助發佈 Web URL，省去架網站的煩惱。GoogleAppScript 和 Google 試算表皆直接存放於 Google 雲端硬碟中，順利達成以最低配置完成永續經營(?)的理念。

創建日期：2020年3月28日 (已於2021年5月停止維護，但不停機)

開發平台：Google Apps Script

伺服器：Google Apps Script

資料庫：Google Sheets

開發語言：javascript

--------
遇到的困難問題
---
_1.傳輸流量爆炸_

基於喜愛分享的個性，同意讓朋友分享到其他群組，也主動貼到大型遊戲討論社團供大家使用。

初期沒有預料到會有大量的使用者使用我的作品，在短短三小時內就讓 Line bot 停止運作。收到大量反映信後緊急去查找問題，才發現 GoogleAppScript 是有每日傳輸限制的(以帳號計算)，當天達到上限便會停止運作，直到隔天重新計算。

解決辦法：

為避免後續有發生相同情況，當下又加開了五隻 Line bot 綁定不同 Google 帳號，且使用不同角色、性格的回話方式去吸引使用者們分散到其他 Line bot 使用，成功達到分流效果。

_2.無測試用Line bot_

正如第一項問題所說，沒有預料到會有大量的使用者使用我的作品，因此也未考慮過在優化、維護或測試增設功能時是否會影響到 User 使用，在嘗試第一次改版時便出現因程式撰寫錯誤導致 Line bot 運作異常等問題，再次收到大量問題回饋訊息。

解決辦法：

立即還原回上一版本，同時也加開了一個機器人充當測試使用，確認功能正常無使用上問題，才會將程式碼覆蓋至其餘五個機器人上。

_3.無防呆措施_

雖然 Line bot 的主頁有詳細說明使用方式和查詢指令，但使用者還是會提出使用上問題，像是指令輸入錯誤後反映機器人查不到資料或已獨不回。

解決辦法：

回復了 N 封類似訊息後，便有了或許能直接在程式上增加判斷做出提醒的想法，也立刻做了修改和調整。自那之後，相關的問題明顯減少，也讓我理解防呆措施有多麼重要。

_4.聊天功能不完善_

聊天功能是朋友提議下新增的功能，期初對於"能自由對話"這項要求沒太大概念，認為只要能做到對答就行，所以我在試算表中建了詞庫，讓程式去判斷詞庫中有無相符的資料，回覆對應的句子。

礙於 Line bot 有人設上性格限制無法直接使用網路上資料，但只要詞庫加入的資料量夠大或許就能做到自由對答，所以我也放上了一個讓使用者自行新增詞彙的功能，卻遇上其他技術問題，當使用者增加"早安"的回覆台詞，Line bot 便會在使用者打"早安"時做出回覆，但遇到打"早上好"、"早"、"早ㄤ"等相同性質的句子，會因程式判斷的方式而得不到回應。

解決辦法：

該問題目前尚未解決，有考慮應用機器學習，但並未學過相關領域知識且大多皆是用 Python 撰寫，GoogleAppScript 不支援 Python 程式語言。網上有查到用 JavaScript 撰寫的方式，但同樣也不確定 GoogleAppScript 能否使用那些元件，必須花些時間了解和測試。

_5.新增詞彙功能存在爭議_

這是上述第四項衍生出的問題，由於爭議很大且挺有挑戰性，因此特別提出來整理。

上千名使用者自行增加詞彙確實解決了資料不足的問題，但每一個 Line bot 都是用遊戲角色塑造的，自然會出現新增了與性格設定不符的台詞被其他使用者發現。剛開始不覺得有太大問題，與管理員們討論後認為定時去整理試算表詞庫即可。

但 Line bot 是24小時運作的，資料新增的速度遠超過我們負荷，那些有問題的應答一個個被挖出來，甚至被貼到遊戲討論社團引起兩派爭論。

解決辦法：

該問題目前尚未解決。為了平息風波原本是打算將這功能刪除，沒想到引起更大反彈，無奈之下只好設定時間限制減輕管理員負擔，同時訂製新增詞彙的規則和不斷呼籲對話紀錄不公開、不分享，才勉強壓下這起事件，但該問題依舊存在，也因此件事情關閉了一個機器人。

--------
Line bot ID
---
- 德州扒雞　@852xfbnb
- 燈影牛肉　@055djbis (已關閉)
- 符離集燒雞　@466rhnvz (已關閉)
- 風生水起　@207bvmkn (已關閉)
- 北京烤鴨　@232sxffv (已關閉)
- 蓮花血鴨　@520cseus  (已關閉)

2022/11/16
